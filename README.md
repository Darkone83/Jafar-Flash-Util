# Jafar Flash Util

<div align=center>

  <img src="https://github.com/Darkone83/Jafar-Flash-Util/blob/main/images/DC%20logo.png">

</div>

A small Python/Tk GUI to program **Lattice LC4032V** CPLDs (as used on Jafar-style Xbox modchips) over **JTAG** using an **FT232H / FT2232H** USB adapter and **UrJTAG**.

This tool wraps UrJTAG so you don’t have to type commands by hand — select your SVF file, hit a button, and you’re done.

---

## Features

- Simple cross‑platform GUI (Windows / Linux, Python + Tkinter).
- Uses **UrJTAG** under the hood (no custom cable drivers).
- Supports:
  - **Detect Lattice Chip** (reads IDCODE and confirms LC4032V).
  - **Program LC4032V** from an SVF file.
  - **Auto‑detect cable** for common FT232H / FT2232H VID/PID combos.
  - **Dependency check** (Python / pip / UrJTAG presence).
- Designed for FTDI‑based adapters like:
  - FT232H “breakout” boards (D0–D3 used as JTAG)
  - FT2232H mini‑modules / clones

---

## Requirements

### Hardware

- A JTAG‑capable FTDI adapter, for example:
  - **FT232H** USB board (recommended default).
  - FT2232H board (if you tweak the cable line).
- Target board with **Lattice LC4032V** (e.g. Jafar chip).

Typical JTAG wiring (FT232H → LC4032V):

| FT232H pin | Direction | LC4032V JTAG |
| ---------- | --------- | ------------ |
| D0         | →         | TCK          |
| D1         | →         | TDI          |
| D2         | ←         | TDO          |
| D3         | →         | TMS          |
| 3V3        | →         | 3.3 V VCC    |
| GND        | ↔         | GND          |

> **Note:** Ensure the CPLD I/O bank is **3.3 V**, not 5 V.

### Software

- **Python 3.8+**
- **Tkinter** (usually included with standard Python):
  - Windows: bundled with the official Python installer.
  - Ubuntu / Debian: `sudo apt install python3-tk`
- **UrJTAG** command‑line tools:
  - Project site: <https://urjtag.sourceforge.io/>
  - Download / files: <https://sourceforge.net/projects/urjtag/files/urjtag/>

On Linux, you can often install with your package manager, e.g.:

```bash
sudo apt install urjtag
```

On Windows, download the pre‑built installer (`urjtag-*.exe`) from SourceForge and make sure `jtag.exe` is on your `PATH` or note its install path.

---

## Getting Started

### 1. Clone the repo

```bash
git clone https://github.com/<your-account>/jafar-flash-util.git
cd jafar-flash-util
```

### 2. Install Python requirements

The GUI only uses the Python standard library (Tkinter, subprocess, etc.), so there is no `requirements.txt` to install. Just make sure Python is installed and working:

```bash
python --version
```

(Use `python3` on Linux if needed.)

### 3. Install UrJTAG

- See official docs and downloads:  
  - <https://urjtag.sourceforge.io/>  
  - <https://sourceforge.net/projects/urjtag/files/urjtag/>

On Windows:

1. Run the `urjtag-*.exe` installer.
2. Confirm `jtag.exe` is in your `PATH` (or remember the full path, e.g. `C:\Program Files (x86)\UrJTAG\jtag.exe`).

On Linux:

```bash
sudo apt install urjtag        # Debian/Ubuntu
# or use your distro’s package manager
```

### 4. Run the GUI

```bash
python jafar_flash_util.py
```

or (if you saved it as a `.pyw`):

```bash
python jafar_flash_util.pyw
```

On Linux, run it under your normal user account (you may need to be in the `dialout` / `plugdev` group or add a `udev` rule for the FTDI device).

---

## GUI Overview

When you launch **Jafar Flash Util**, you’ll see:

- **UrJTAG executable**  
  - Either leave it as `jtag` if UrJTAG is on your PATH,  
  - or click **Browse…** and select the UrJTAG binary (`jtag` / `jtag.exe`).

- **SVF file**  
  - Click **Browse…** and choose the SVF file generated by Lattice Diamond for your LC4032V / Jafar CPLD.

- **Cable config (UrJTAG)**  
  - Default: `cable ft232h vid 0x0403 pid 0x6014` (suitable for most FT232H Amazon breakouts).
  - You can edit this if you use a different adapter (e.g. `ft2232` with `interface 0`).

### Buttons

- **Check Dependencies**  
  - Verifies Python, pip, and that UrJTAG responds to `jtag -v`.
  - If UrJTAG is missing, offers a link to the SourceForge download page.

- **Auto‑detect Cable**  
  - Tries a small set of common cable lines (`ft232h`, `ft2232` variants).
  - Runs `detect` via UrJTAG and picks the first configuration that successfully sees a JTAG chain.

- **Detect Lattice Chip**  
  - Runs UrJTAG with your current cable configuration and prints the detected device info.
  - You should see something like:  
    `Manufacturer: Lattice Semiconductors, Part: LC4032V-TQFP48`

- **Program LC4032V**  
  - Uses your cable config, runs `detect`, then plays back the selected SVF file via UrJTAG.
  - Shows all UrJTAG output in the log window and reports success/failure.

---

## Typical Workflow

1. Wire FT232H ↔ LC4032V (D0–D3, 3V3, GND).
2. Launch **Jafar Flash Util**.
3. Set **UrJTAG executable**:
   - Leave as `jtag` if it’s in PATH, or
   - Browse to `jtag` / `jtag.exe` manually.
4. (Optional) Click **Check Dependencies** to confirm UrJTAG is reachable.
5. (Optional) Click **Auto‑detect Cable** and let it find a working FTDI configuration.
6. Click **Detect Lattice Chip** and confirm it prints your LC4032V.
7. Export an **SVF** file from Lattice Diamond for your Jafar CPLD.
8. Select the SVF file and click **Program LC4032V**.
9. Watch the log for any `svf:` errors or non‑zero exit codes.

If everything is OK you’ll see `=== Programming finished (exit code 0) ===` and your CPLD should now be programmed.

---

## Generating the SVF (Lattice Diamond)

1. Open your LC4032V project in **Lattice Diamond**.
2. Run **Synthesis / Implementation**.
3. In the programming options, choose **Export SVF** for the target device.
4. Save the `.svf` file somewhere easy to find (e.g. `firmware/jafar_cpld.svf`).

Point the GUI at that file under **SVF file** and you’re good.

---

## Basic Troubleshooting

### 1. UrJTAG not found

- Symptom: the log shows `ERROR: UrJTAG executable not found` or `FileNotFoundError`.
- Fix:
  - Install UrJTAG.
  - Make sure `jtag` is on your PATH; or
  - Use **Browse…** to select the full path to the UrJTAG binary.

### 2. “TDO seems to be stuck at 1”

- This usually means UrJTAG cannot talk to a real JTAG device:
  - TDO not wired or wired to the wrong pin.
  - Wrong cable line (e.g. using `ft2232` with an FT232H board).
  - Target not powered, or not at 3.3 V.
- Check:
  - Wiring: D0→TCK, D1→TDI, D2←TDO, D3→TMS.
  - `cable` line matches your adapter (`ft232h` vs `ft2232`).
  - LC4032V is powered and shares ground with the FTDI board.

### 3. SVF file errors (“cannot open file” / “syntax error”)

- Confirm the **SVF path is correct** in the GUI.
- Avoid spaces in folder names if your UrJTAG build is older and picky about quoting.
- Make sure the SVF was generated for the correct device (LC4032V) and is not empty or truncated.

### 4. Permission issues on Linux

- If the FTDI device cannot be opened:
  - Add your user to the appropriate group (e.g. `dialout`, `plugdev`).
  - Or add a `udev` rule for your FT232H/FT2232H VID/PID.
- Re‑plug the adapter after changing groups or rules.

---

## License

This utility is intended as a thin Python wrapper around **UrJTAG**, which is licensed under GPLv2 / MIT (see the UrJTAG project for details).  
Choose an appropriate license for this repo that is compatible with your intended use (GPL‑compatible is recommended if you distribute UrJTAG binaries alongside).

---

## Credits

- **Jafar Flash Util** GUI and workflow by **Darkone83**.
- Powered by **UrJTAG**: <https://urjtag.sourceforge.io/>
- FTDI‑based JTAG connectivity (FT232H / FT2232H).
